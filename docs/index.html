<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="30">
    <title>MentorAI Evaluation Dashboard - aggregated-20260122</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f3f4f6;
            color: #1f2937;
            line-height: 1.5;
            padding: 2rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .card-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        .card-value {
            font-size: 2rem;
            font-weight: 700;
        }
        .card-value.pass {
            color: #10b981;
        }
        .card-value.fail {
            color: #ef4444;
        }
        .section {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .section-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            font-weight: 600;
            font-size: 0.875rem;
            color: #6b7280;
            background: #f9fafb;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }
        .progress-fill.high {
            background: #10b981;
        }
        .progress-fill.medium {
            background: #f59e0b;
        }
        .progress-fill.low {
            background: #ef4444;
        }
        .verdict {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .verdict.pass {
            background: #d1fae5;
            color: #065f46;
        }
        .verdict.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .verdict.pending {
            background: #e5e7eb;
            color: #4b5563;
        }
        .na-badge {
            color: #6b7280;
            font-size: 0.85em;
        }
        .warning-badge {
            cursor: help;
        }
        .expandable {
            cursor: pointer;
        }
        .expandable:hover {
            background: #f9fafb;
        }
        .details {
            display: none;
            background: #f9fafb;
        }
        .details.open {
            display: table-row;
        }
        .details-content {
            padding: 1rem;
            font-size: 0.875rem;
        }
        .quality-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem 1.5rem;
            background: #f9fafb;
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
        }
        .quality-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .quality-item span:first-child {
            font-weight: 500;
            color: #374151;
            text-transform: capitalize;
        }
        .quality-item span:last-child {
            font-size: 0.875rem;
            color: #10b981;
            font-weight: 600;
        }
        .timestamp {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        footer {
            text-align: center;
            padding: 1rem;
            color: #9ca3af;
            font-size: 0.75rem;
        }
        /* Evidence display styles */
        .evidence-section {
            margin-top: 1rem;
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
        }
        .evidence-section h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
        }
        .criterion-item {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.375rem;
            border-left: 3px solid;
        }
        .criterion-item.pass {
            background: #f0fdf4;
            border-left-color: #10b981;
        }
        .criterion-item.fail {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        .criterion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .criterion-code {
            font-weight: 600;
            font-size: 0.875rem;
        }
        .criterion-item.pass .criterion-code {
            color: #065f46;
        }
        .criterion-item.fail .criterion-code {
            color: #991b1b;
        }
        .evidence-text {
            font-size: 0.8125rem;
            color: #4b5563;
            line-height: 1.6;
            font-style: italic;
        }
        .evidence-text::before {
            content: '"';
        }
        .evidence-text::after {
            content: '"';
        }
        .judge-section {
            margin-top: 1.5rem;
        }
        .judge-section h5 {
            font-size: 0.8125rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .failed-summary {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }
        .failed-summary-title {
            font-weight: 600;
            color: #991b1b;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .toggle-evidence {
            font-size: 0.75rem;
            color: #6b7280;
            cursor: pointer;
            text-decoration: underline;
        }
        .toggle-evidence:hover {
            color: #374151;
        }
        .criteria-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .criteria-list.expanded {
            max-height: 2000px;
        }
        /* Expandable criteria rows */
        .criteria-expand-row {
            cursor: pointer;
        }
        .criteria-expand-row:hover {
            background: #f9fafb;
        }
        .criteria-expand-row td:first-child::before {
            content: '▶';
            display: inline-block;
            margin-right: 0.5rem;
            font-size: 0.625rem;
            transition: transform 0.2s ease;
            color: #9ca3af;
        }
        .criteria-expand-row.open td:first-child::before {
            transform: rotate(90deg);
        }
        .criteria-details-row {
            display: none;
            background: #f9fafb;
        }
        .criteria-details-row.open {
            display: table-row;
        }
        .persona-tag {
            font-size: 0.75rem;
            background: #e0e7ff;
            color: #4338ca;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MentorAI Evaluation Dashboard</h1>
            <div class="meta">
                <span>Run: <strong>aggregated-20260122</strong></span>
                <span class="badge" style="background: #10b981">Complete</span>
                <span class="timestamp">Updated: 2026-01-22T08:20:43.459439</span>
            </div>
        </header>

        <div class="cards">
            <div class="card">
                <div class="card-label">Critical Pass Rate</div>
                <div class="card-value pass">100.0%</div>
                <div class="card-label">1/1 passed</div>
            </div>
            <div class="card">
                <div class="card-label">Quality Average</div>
                <div class="card-value">100.0%</div>
                <div class="card-label">20/20 criteria</div>
            </div>
            <div class="card">
                <div class="card-label">Progress</div>
                <div class="card-value">1/1</div>
                <div class="card-label">conversations evaluated</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">Per-Criteria Results</div>
            <table>
                <thead id="criteria-header">
                </thead>
                <tbody id="criteria-table">
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-header">Per-Conversation Results</div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Persona</th>
                        <th>Critical</th>
                        <th>Quality Score</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="conversations">
                </tbody>
            </table>
        </div>

        <footer>
            Auto-refreshes every 30 seconds when hosted. Last generated: 2026-01-22T08:20:43.459559
        </footer>
    </div>

    <script>
        const manifest = {
  "run_id": "aggregated-20260122",
  "timestamp": "2026-01-22T08:20:43.459439",
  "status": "complete",
  "conversations": [
    {
      "langsmith_id": "067b83df-d910-4dee-b890-c301e5864205",
      "short_id": "067b83df",
      "source_type": "dataset",
      "persona": "bailey_SBI",
      "critical_verdict": "PASS",
      "critical_json": {
        "criteria": {
          "B-01": {
            "verdict": "PASS",
            "evidence": "Mentor demonstrates a complete SBI example: 'Anchor to one moment: \"In Tuesday's standup, right after I started my update\u2026\" Describe observable behavior: \"\u2026you began talking at the same time and said, 'We're off track,' twice.\" Own the impact: \"\u2026I felt flustered and lost my place, and the team didn't hear the dependency I was flagging.\"'"
          },
          "C-01": {
            "verdict": "PASS",
            "evidence": "Mentor quotes specific problematic language: 'the behavior line leans on labels/guesses (\"jumped in,\" \"took over,\" \"maybe said\u2026\") instead of recorder-ready specifics, and the impact drifts into judgment/hedging (\"made my part seem less important,\" \"didn't feel great\").'"
          },
          "C-03": {
            "verdict": "PASS",
            "evidence": "Mentor explicitly requests revisions multiple times: 'Give it a go: post your full draft again with that tweak.' and 'Revise with one locked anchor (no \"I think/maybe\"), camera-testable behavior (overlap, exact words, counts/timing), and fully owned impact\u2014then post your full rewrite.'"
          },
          "D-01": {
            "verdict": "PASS",
            "evidence": "When learner wrote 'In our project sync last week\u2014maybe Tuesday's? Or it could've been Thursday's' and later 'In the client QBR on Friday\u2026 I think it was Friday?', mentor caught this: 'Let's lock Tuesday's sync' and 'the anchor is hedged (\"I think\u2026?\")' prompting for specific time."
          },
          "D-02": {
            "verdict": "PASS",
            "evidence": "Mentor catches judgment words multiple times. When learner used 'jumped in,' 'steering,' 'took over,' mentor responded: 'you spotted the exact drift (\"jumped in/steering/took over\" are labels)' and later 'the behavior line leans on labels/guesses (\"jumped in,\" \"took over,\" \"maybe said\u2026\")' prompting for observable actions."
          },
          "D-03": {
            "verdict": "PASS",
            "evidence": "When learner wrote 'I'm concerned the team didn't hear\u2026' mentor identified this as drifting: 'If you stay fully in your lane, how would you rewrite the second half to be either your emotion or a direct consequence you experienced' and prompted for owned 'I' statements."
          },
          "E-03": {
            "verdict": "PASS",
            "evidence": "When learner asked 'Could you help me rewrite the behavior line so it's fully camera\u2011testable?' mentor didn't provide the answer but instead asked: 'what would a recorder show after \"we're off track\" that could replace \"took over/didn't let me finish\"... can you recast the behavior as one sentence using those specifics?'"
          }
        },
        "overall": {
          "verdict": "PASS",
          "summary": "The mentor demonstrated all critical tutoring behaviors including modeling SBI, providing specific feedback with quoted language, requesting revisions, catching vague situations and judgment leakage, addressing accusatory impact, and protecting productive struggle by requiring learner attempts.",
          "passed_count": 7,
          "failed_count": 0,
          "na_count": 0,
          "failed_criteria": []
        },
        "_metadata": {
          "judge_id": "critical_criteria",
          "conversation_id": "067b83df",
          "evaluated_at": "2026-01-22T08:19:11.272726"
        }
      },
      "quality_results": {
        "session_setup": {
          "passed": 3,
          "total": 3,
          "na_count": 0,
          "json": {
            "criteria": {
              "A-01": {
                "verdict": "PASS",
                "evidence": "Mentor opens with: 'We're working on delivering peer feedback using SBI: concrete moment, camera-testable behavior, and owned impact\u2014and spotting when judgment sneaks into behavior.'"
              },
              "A-02": {
                "verdict": "PASS",
                "evidence": "Mentor explicitly signals transition: 'I'll demonstrate how I approach it, then we'll get you practicing toward two solid attempts.' Later signals practice phase: 'Ready to try a first full draft using that cue?'"
              },
              "A-03": {
                "verdict": "PASS",
                "evidence": "Two realistic workplace scenarios: (1) Tuesday's project sync where a colleague interrupted during an update about API dependencies, and (2) Friday's Acme client QBR where manager moved meeting forward during a risk update with leadership and client present\u2014both with plausible interpersonal dynamics."
              }
            },
            "overall": {
              "passed_count": 3,
              "failed_count": 0,
              "pass_rate": 1.0,
              "failed_criteria": []
            },
            "_metadata": {
              "judge_id": "session_setup",
              "conversation_id": "067b83df",
              "evaluated_at": "2026-01-22T08:19:24.284310"
            }
          }
        },
        "modeling_quality": {
          "passed": 4,
          "total": 4,
          "na_count": 0,
          "json": {
            "criteria": {
              "B-02": {
                "verdict": "PASS",
                "evidence": "During modeling, mentor explains: 'Notice the decision point: I didn't say \"you were dismissive\" (judgment); I used overlapping speech + exact words (camera-testable).' This explains WHY they made the choice, not just what the components are."
              },
              "B-03": {
                "verdict": "PASS",
                "evidence": "Mentor explicitly shows a choice point: 'I didn't say \"you were dismissive\" (judgment); I used overlapping speech + exact words (camera-testable).' This demonstrates considering an alternative ('dismissive') and rejecting it in favor of observable behavior."
              },
              "B-04": {
                "verdict": "PASS",
                "evidence": "Mentor models self-checking by asking 'What do you notice about how I kept the behavior judgment-free before we try a quick check?' and later teaches the learner to use the 'recorder test' as a self-verification process, demonstrating the checking mindset."
              },
              "B-05": {
                "verdict": "PASS",
                "evidence": "Mentor offers multiple reusable heuristics: 'camera-testable = a neutral observer could record it\u2014verbs, quotes, countable actions, not labels' and later helps learner develop 'Recorder, not mind-reader; own your impact' as a generalizable rule of thumb."
              }
            },
            "overall": {
              "passed_count": 4,
              "failed_count": 0,
              "pass_rate": 1.0,
              "failed_criteria": []
            },
            "_metadata": {
              "judge_id": "modeling_quality",
              "conversation_id": "067b83df",
              "evaluated_at": "2026-01-22T08:19:38.829326"
            }
          }
        },
        "coaching_quality": {
          "passed": 5,
          "total": 5,
          "na_count": 0,
          "json": {
            "criteria": {
              "C-02": {
                "verdict": "PASS",
                "evidence": "Mentor consistently provides actionable direction. For example: 'Drop the last clause (\"which felt like you took over\")\u2014that's impact/judgment creeping in\u2014and end the behavior at \"but didn't finish.\"' Also: 'Revise with one locked anchor (no \"I think/maybe\"), camera-testable behavior (overlap, exact words, counts/timing), and fully owned impact\u2014then post your full rewrite.'"
              },
              "C-04": {
                "verdict": "PASS",
                "evidence": "Mentor specifically evaluates revisions. For example: 'That holds together and passes the recorder filter\u2014anchored moment, camera-testable behavior, owned impact. That's your first solid attempt.' Also: 'This passes the recorder filter and meets the bar for an upward feedback moment\u2014anchored, camera\u2011testable behavior, owned impact. Your specifics (overlap, \"let's move on,\" advancing the deck, one attempt to continue) are exactly the kind of evidence that steadies tone.'"
              },
              "C-05": {
                "verdict": "PASS",
                "evidence": "Mentor explores errors before correcting. When learner asks about 'interrupted' vs observable behavior, mentor asks: 'Quick check: which one passes the camera test and why\u2014\"you interrupted me,\" or \"you started talking at the same time and said 'we're off track'\"? Your call.' Also asks 'Before I weigh in, where do you think I'll push back\u2014on the anchor, the behavior details, or the impact language\u2014and why?' letting learner work through it."
              },
              "C-06": {
                "verdict": "PASS",
                "evidence": "Mentor asks learner to explain reasoning behind choices. Examples: 'What do you notice about how I kept the behavior judgment-free before we try a quick check?' and 'Before I weigh in, where do you think I'll push back\u2014on the anchor, the behavior details, or the impact language\u2014and why?' These ask learner to articulate their thinking process."
              },
              "C-07": {
                "verdict": "PASS",
                "evidence": "Mentor prompts reflection on learning: 'Your turn: what's the single principle you'll carry forward to keep your feedback steady under pressure?' This asks learner to step back and reflect on what they'll carry forward from the session."
              }
            },
            "overall": {
              "passed_count": 5,
              "failed_count": 0,
              "pass_rate": 1.0,
              "failed_criteria": []
            },
            "_metadata": {
              "judge_id": "coaching_quality",
              "conversation_id": "067b83df",
              "evaluated_at": "2026-01-22T08:19:57.199543"
            }
          }
        },
        "sbi_content": {
          "passed": 3,
          "total": 3,
          "na_count": 0,
          "json": {
            "criteria": {
              "D-04": {
                "verdict": "PASS",
                "evidence": "Mentor asks 'which one passes the camera test and why\u2014\"you interrupted me,\" or \"you started talking at the same time and said 'we're off track'\"? Your call.' This directly probes whether the learner can distinguish observable behavior from interpretation."
              },
              "D-05": {
                "verdict": "PASS",
                "evidence": "When learner struggles with the behavior line, mentor offers targeted scaffolding: 'what would a recorder show after \"we're off track\" that could replace \"took over/didn't let me finish\"\u2014e.g., overlap length, how many times you tried to continue, or how long they spoke\u2014and can you recast the behavior as one sentence using those specifics?' This provides specific alternatives to build from."
              },
              "D-06": {
                "verdict": "PASS",
                "evidence": "Mentor provides the 'Recorder, not mind-reader' test as a reusable tool, refined to a sticky-note cue: 'Recorder, not mind\u2011reader \u2014 verbs, quotes, counts/timing, no intent labels.' Also provides a two-beat mantra: 'Recorder, not mind\u2011reader; own your impact' that learner explicitly plans to use independently."
              }
            },
            "overall": {
              "passed_count": 3,
              "failed_count": 0,
              "pass_rate": 1.0,
              "failed_criteria": []
            },
            "_metadata": {
              "judge_id": "sbi_content",
              "conversation_id": "067b83df",
              "evaluated_at": "2026-01-22T08:20:12.250577"
            }
          }
        },
        "adaptive_pacing": {
          "passed": 2,
          "total": 2,
          "na_count": 0,
          "json": {
            "criteria": {
              "E-01": {
                "verdict": "PASS",
                "evidence": "Mentor checks readiness multiple times: 'Ready to start?', 'Ready to try a first full draft using that cue?', 'Before we practice, what's a quick 10\u2011second self-check you'll use...', 'Say that line out loud once\u2014does it feel like a true 10\u2011second check you'll actually use?'"
              },
              "E-02": {
                "verdict": "PASS",
                "evidence": "Mentor fades support as learner improves. Early on, mentor provides detailed explanations and examples. Later, mentor asks learner to self-evaluate: 'Before I weigh in, where do you think I'll push back\u2014on the anchor, the behavior details, or the impact language\u2014and why?' By the end, mentor confirms drafts quickly ('This passes the recorder filter') and asks learner to articulate their own principle: 'what's the single principle you'll carry forward...'"
              }
            },
            "overall": {
              "passed_count": 2,
              "failed_count": 0,
              "pass_rate": 1.0,
              "failed_criteria": []
            },
            "_metadata": {
              "judge_id": "adaptive_pacing",
              "conversation_id": "067b83df",
              "evaluated_at": "2026-01-22T08:20:25.453836"
            }
          }
        },
        "conversational_quality": {
          "passed": 3,
          "total": 3,
          "na_count": 0,
          "json": {
            "criteria": {
              "F-01": {
                "verdict": "PASS",
                "evidence": "Mentor varies turn structure throughout: short reactions ('You're not overthinking'), longer explanations with bullet points (demo turn), quick checks ('Your call'), brief affirmations ('That holds together and passes the recorder filter\u2014anchored moment, camera-testable behavior, owned impact. That's your first solid attempt \ud83d\udc4d'), and questions of varying complexity."
              },
              "F-02": {
                "verdict": "PASS",
                "evidence": "Mentor shows personality with emoji ('\ud83d\udc4d'), casual phrases ('Totally normal to worry,' 'Totally get the hesitation,' 'Totally fair to want a sticky'), and encouraging reactions ('Nice catch' style moments like 'You're reading it right\u2014those edge cases are tricky'). Has a warm, supportive voice rather than purely neutral facilitation."
              },
              "F-03": {
                "verdict": "PASS",
                "evidence": "When learner repeatedly expresses anxiety ('I'm probably going to ask is this too harsh a lot,' 'Sorry if I'm overthinking,' 'I'm still a little nervous'), mentor consistently acknowledges and validates: 'Totally normal to worry about harshness,' 'You're not overthinking\u2014these edge cases trip people up,' 'Sounds totally fair to feel edgy giving this upward\u2014SBI is what keeps it steady, not harsh.'"
              }
            },
            "overall": {
              "passed_count": 3,
              "failed_count": 0,
              "na_count": 0,
              "pass_rate": 1.0,
              "failed_criteria": []
            },
            "_metadata": {
              "judge_id": "conversational_quality",
              "conversation_id": "067b83df",
              "evaluated_at": "2026-01-22T08:20:43.272674"
            }
          }
        }
      }
    }
  ],
  "aggregated_from": [
    "20260122_081841"
  ],
  "config": {
    "source": "aggregated",
    "total_runs": 1,
    "date_filter": "today"
  }
};
        const metrics = {"total": 1, "completed": 1, "critical_passed": 1, "critical_failed": 0, "critical_pass_rate": 100.0, "quality_total_passed": 20, "quality_total_criteria": 20, "quality_average": 100.0, "per_criteria": {"session_setup": {"passed": 3, "total": 3, "individual": {"A-01": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "A-02": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "A-03": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}}, "by_persona": {"amara_SBI": {"passed": 0, "total": 0}, "bailey_SBI": {"passed": 3, "total": 3}, "carlos_SBI": {"passed": 0, "total": 0}, "daniel_SBI": {"passed": 0, "total": 0}, "elise_SBI": {"passed": 0, "total": 0}, "fatou_SBI": {"passed": 0, "total": 0}}, "percentage": 100.0}, "modeling_quality": {"passed": 4, "total": 4, "individual": {"B-02": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "B-03": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "B-04": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "B-05": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}}, "by_persona": {"amara_SBI": {"passed": 0, "total": 0}, "bailey_SBI": {"passed": 4, "total": 4}, "carlos_SBI": {"passed": 0, "total": 0}, "daniel_SBI": {"passed": 0, "total": 0}, "elise_SBI": {"passed": 0, "total": 0}, "fatou_SBI": {"passed": 0, "total": 0}}, "percentage": 100.0}, "coaching_quality": {"passed": 5, "total": 5, "individual": {"C-02": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "C-04": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "C-05": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "C-06": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "C-07": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}}, "by_persona": {"amara_SBI": {"passed": 0, "total": 0}, "bailey_SBI": {"passed": 5, "total": 5}, "carlos_SBI": {"passed": 0, "total": 0}, "daniel_SBI": {"passed": 0, "total": 0}, "elise_SBI": {"passed": 0, "total": 0}, "fatou_SBI": {"passed": 0, "total": 0}}, "percentage": 100.0}, "sbi_content": {"passed": 3, "total": 3, "individual": {"D-04": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "D-05": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "D-06": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}}, "by_persona": {"amara_SBI": {"passed": 0, "total": 0}, "bailey_SBI": {"passed": 3, "total": 3}, "carlos_SBI": {"passed": 0, "total": 0}, "daniel_SBI": {"passed": 0, "total": 0}, "elise_SBI": {"passed": 0, "total": 0}, "fatou_SBI": {"passed": 0, "total": 0}}, "percentage": 100.0}, "adaptive_pacing": {"passed": 2, "total": 2, "individual": {"E-01": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "E-02": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}}, "by_persona": {"amara_SBI": {"passed": 0, "total": 0}, "bailey_SBI": {"passed": 2, "total": 2}, "carlos_SBI": {"passed": 0, "total": 0}, "daniel_SBI": {"passed": 0, "total": 0}, "elise_SBI": {"passed": 0, "total": 0}, "fatou_SBI": {"passed": 0, "total": 0}}, "percentage": 100.0}, "conversational_quality": {"passed": 3, "total": 3, "individual": {"F-01": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "F-02": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}, "F-03": {"passed": 1, "failed": 0, "by_persona": {"amara_SBI": {"passed": 0, "failed": 0}, "bailey_SBI": {"passed": 1, "failed": 0}, "carlos_SBI": {"passed": 0, "failed": 0}, "daniel_SBI": {"passed": 0, "failed": 0}, "elise_SBI": {"passed": 0, "failed": 0}, "fatou_SBI": {"passed": 0, "failed": 0}}}}, "by_persona": {"amara_SBI": {"passed": 0, "total": 0}, "bailey_SBI": {"passed": 3, "total": 3}, "carlos_SBI": {"passed": 0, "total": 0}, "daniel_SBI": {"passed": 0, "total": 0}, "elise_SBI": {"passed": 0, "total": 0}, "fatou_SBI": {"passed": 0, "total": 0}}, "percentage": 100.0}}, "personas_seen": ["bailey_SBI"], "persona_letters": {"amara_SBI": "A", "bailey_SBI": "B", "carlos_SBI": "C", "daniel_SBI": "D", "elise_SBI": "E", "fatou_SBI": "F"}};

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function extractPersona(conv) {
            // Try persona field first (if valid)
            if (conv.persona && conv.persona !== 'Unknown' && conv.persona !== 'unknown') {
                return conv.persona;
            }
            // Try run_name pattern
            if (conv.run_name) {
                const match = conv.run_name.match(/([a-z]+_SBI)/i);
                if (match) return match[1].toLowerCase().replace('_sbi', '_SBI');
            }
            // Try dataset_name (batch datasets include persona)
            if (conv.dataset_name) {
                const match = conv.dataset_name.match(/([a-z]+_SBI)/i);
                if (match) return match[1].toLowerCase().replace('_sbi', '_SBI');
            }
            return 'Unknown';
        }

        function renderCriteriaTable() {
            const thead = document.getElementById('criteria-header');
            const tbody = document.getElementById('criteria-table');
            const perCriteria = metrics.per_criteria || {};
            const personasSeen = metrics.personas_seen || [];
            const personaLetters = metrics.persona_letters || {};
            const numPersonaCols = personasSeen.length;
            const totalCols = 4 + numPersonaCols;

            // Render header
            let headerHtml = '<tr><th>Criterion</th><th>Passed</th><th>Pass Rate</th>';
            personasSeen.forEach(p => {
                headerHtml += `<th style="width: 40px; text-align: center" title="${p}">${personaLetters[p] || p[0].toUpperCase()}</th>`;
            });
            headerHtml += '<th style="width: 25%">Progress</th></tr>';
            thead.innerHTML = headerHtml;

            Object.entries(perCriteria).forEach(([judgeId, data], index) => {
                const percentage = data.percentage || 0;
                const progressClass = percentage >= 80 ? 'high' : percentage >= 50 ? 'medium' : 'low';
                const byPersona = data.by_persona || {};

                // Main row
                const row = document.createElement('tr');
                row.className = 'criteria-expand-row';
                row.onclick = () => toggleCriteriaDetails(index);
                let rowHtml = `
                    <td>${judgeId.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</td>
                    <td>${data.passed}/${data.total}</td>
                    <td>${percentage}%</td>
                `;
                // Add persona columns
                personasSeen.forEach(p => {
                    const pData = byPersona[p] || {passed: 0, total: 0};
                    const pPct = pData.total > 0 ? Math.round(pData.passed / pData.total * 100) : '-';
                    const pClass = pPct === '-' ? '' : (pPct >= 80 ? 'pass' : 'fail');
                    rowHtml += `<td style="text-align: center" class="${pClass}">${pPct}${pPct !== '-' ? '%' : ''}</td>`;
                });
                // Progress bar at end
                rowHtml += `<td>
                    <div class="progress-bar">
                        <div class="progress-fill ${progressClass}" style="width: ${percentage}%"></div>
                    </div>
                </td>`;
                row.innerHTML = rowHtml;
                tbody.appendChild(row);

                // Details row with individual criteria
                const detailsRow = document.createElement('tr');
                detailsRow.className = 'criteria-details-row';
                detailsRow.id = `criteria-details-${index}`;

                const individual = data.individual || {};
                const sortedCriteria = Object.entries(individual).sort((a, b) => a[0].localeCompare(b[0]));

                // Add individual criteria as sub-rows (same format as main rows)
                sortedCriteria.forEach(([code, stats]) => {
                    const total = stats.passed + stats.failed;
                    const hasFail = stats.failed > 0;
                    const pct = total > 0 ? Math.round(stats.passed / total * 100) : 0;
                    const progressClass = pct >= 80 ? 'high' : pct >= 50 ? 'medium' : 'low';
                    const cByPersona = stats.by_persona || {};

                    const subRow = document.createElement('tr');
                    subRow.className = 'criteria-details-row';
                    subRow.id = `criteria-details-${index}-${code}`;

                    let subRowHtml = `
                        <td style="padding-left: 2rem; color: #6b7280;">${code}</td>
                        <td>${stats.passed}/${total}</td>
                        <td>${pct}%</td>
                    `;
                    // Add persona columns
                    personasSeen.forEach(p => {
                        const ps = cByPersona[p] || {passed: 0, failed: 0};
                        const pTotal = ps.passed + ps.failed;
                        const pPct = pTotal > 0 ? Math.round(ps.passed / pTotal * 100) : '-';
                        const pClass = pPct === '-' ? '' : (pPct >= 80 ? 'pass' : 'fail');
                        subRowHtml += `<td style="text-align: center" class="${pClass}">${pPct}${pPct !== '-' ? '%' : ''}</td>`;
                    });
                    // Progress bar at end
                    subRowHtml += `<td>
                        <div class="progress-bar">
                            <div class="progress-fill ${progressClass}" style="width: ${pct}%"></div>
                        </div>
                    </td>`;
                    subRow.innerHTML = subRowHtml;
                    tbody.appendChild(subRow);
                });
            });
        }

        function toggleCriteriaDetails(index) {
            const row = document.querySelectorAll('.criteria-expand-row')[index];
            row.classList.toggle('open');
            // Toggle all sub-rows for this index
            document.querySelectorAll(`[id^="criteria-details-${index}-"]`).forEach(el => {
                el.classList.toggle('open');
            });
        }

        function renderCriteriaEvidence(criteria, showAll = false) {
            if (!criteria || Object.keys(criteria).length === 0) {
                return '<em>No criteria data available</em>';
            }

            // Separate failed and passed criteria
            const failed = [];
            const passed = [];
            for (const [code, data] of Object.entries(criteria)) {
                if (data.verdict === 'FAIL') {
                    failed.push({ code, ...data });
                } else if (data.verdict === 'PASS') {
                    passed.push({ code, ...data });
                }
            }

            let html = '';

            // Always show failed criteria first and prominently
            if (failed.length > 0) {
                html += '<div class="failed-summary"><div class="failed-summary-title">Failed Criteria (' + failed.length + ')</div>';
                failed.forEach(item => {
                    html += `<div class="criterion-item fail">
                        <div class="criterion-header">
                            <span class="criterion-code">${item.code}</span>
                            <span class="verdict fail">FAIL</span>
                        </div>
                        <div class="evidence-text">${escapeHtml(item.evidence)}</div>
                    </div>`;
                });
                html += '</div>';
            }

            // Show passed criteria (collapsed by default if there are many)
            if (passed.length > 0 && showAll) {
                html += '<div class="passed-criteria">';
                passed.forEach(item => {
                    html += `<div class="criterion-item pass">
                        <div class="criterion-header">
                            <span class="criterion-code">${item.code}</span>
                            <span class="verdict pass">PASS</span>
                        </div>
                        <div class="evidence-text">${escapeHtml(item.evidence)}</div>
                    </div>`;
                });
                html += '</div>';
            } else if (passed.length > 0) {
                html += `<div class="toggle-evidence" onclick="this.nextElementSibling.classList.toggle('expanded'); this.textContent = this.nextElementSibling.classList.contains('expanded') ? 'Hide ${passed.length} passed criteria' : 'Show ${passed.length} passed criteria'">Show ${passed.length} passed criteria</div>`;
                html += '<div class="criteria-list">';
                passed.forEach(item => {
                    html += `<div class="criterion-item pass">
                        <div class="criterion-header">
                            <span class="criterion-code">${item.code}</span>
                            <span class="verdict pass">PASS</span>
                        </div>
                        <div class="evidence-text">${escapeHtml(item.evidence)}</div>
                    </div>`;
                });
                html += '</div>';
            }

            return html;
        }

        function renderConversations() {
            const tbody = document.getElementById('conversations');
            const conversations = manifest.conversations || [];

            conversations.forEach((conv, index) => {
                const criticalVerdict = conv.critical_verdict || 'PENDING';
                const criticalJson = conv.critical_json || {};
                const qualityResults = conv.quality_results || {};

                // Calculate quality score
                let qualityPassed = 0;
                let qualityTotal = 0;
                let qualityNA = 0;
                let hasParseIssue = false;
                const EXPECTED_TOTAL = 20;  // 3+4+5+3+2+3 = 20 max criteria

                for (const [judge, result] of Object.entries(qualityResults)) {
                    qualityPassed += result.passed || 0;
                    qualityTotal += result.total || 0;
                    // Check na_count at top level (new format) or nested in json.overall (existing data)
                    qualityNA += result.na_count || (result.json && result.json.overall && result.json.overall.na_count) || 0;
                }

                // Flag if total + NA < expected (indicates parsing failure, not just N/A)
                const actualTotal = qualityTotal + qualityNA;
                if (qualityTotal > 0 && actualTotal < EXPECTED_TOTAL) {
                    hasParseIssue = true;
                }

                // Build score string
                let qualityScore = '-';
                if (qualityTotal > 0) {
                    qualityScore = `${qualityPassed}/${qualityTotal}`;
                    if (qualityNA > 0) {
                        qualityScore += ` <span class="na-badge" title="${qualityNA} criteria N/A">(${qualityNA} N/A)</span>`;
                    }
                    if (hasParseIssue) {
                        qualityScore += ` <span class="warning-badge" title="Some criteria failed to parse">⚠️</span>`;
                    }
                }

                // Extract persona
                const persona = extractPersona(conv);

                // Main row
                const row = document.createElement('tr');
                row.className = 'expandable';
                row.onclick = () => toggleDetails(index);
                row.innerHTML = `
                    <td>${conv.short_id}</td>
                    <td><span class="persona-tag">${persona}</span></td>
                    <td><span class="verdict ${criticalVerdict.toLowerCase()}">${criticalVerdict}</span></td>
                    <td>${qualityScore}</td>
                    <td><span class="verdict ${criticalVerdict === 'PENDING' ? 'pending' : 'pass'}">
                        ${criticalVerdict === 'PENDING' ? 'Pending' : 'Complete'}
                    </span></td>
                `;
                tbody.appendChild(row);

                // Details row with full evidence
                const detailsRow = document.createElement('tr');
                detailsRow.className = 'details';
                detailsRow.id = `details-${index}`;

                let detailsHtml = '<td colspan="5"><div class="details-content">';

                // Quality summary grid
                if (Object.keys(qualityResults).length > 0) {
                    detailsHtml += '<div class="quality-grid" style="margin-bottom: 1rem;">';
                    for (const [judge, result] of Object.entries(qualityResults)) {
                        const passed = result.passed || 0;
                        const total = result.total || 0;
                        const pct = total > 0 ? Math.round(passed / total * 100) : 0;
                        detailsHtml += `<div class="quality-item"><span>${judge.replace(/_/g, ' ')}</span><span>${passed}/${total} (${pct}%)</span></div>`;
                    }
                    detailsHtml += '</div>';
                }

                // Critical criteria evidence
                if (criticalJson.criteria) {
                    detailsHtml += '<div class="evidence-section">';
                    detailsHtml += '<h4>Critical Criteria Evidence</h4>';
                    detailsHtml += renderCriteriaEvidence(criticalJson.criteria);
                    detailsHtml += '</div>';
                }

                // Quality judges evidence
                for (const [judgeName, result] of Object.entries(qualityResults)) {
                    if (result.json && result.json.criteria) {
                        detailsHtml += '<div class="judge-section">';
                        detailsHtml += `<h5>${judgeName.replace(/_/g, ' ')}</h5>`;
                        detailsHtml += renderCriteriaEvidence(result.json.criteria);
                        detailsHtml += '</div>';
                    }
                }

                if (!criticalJson.criteria && Object.keys(qualityResults).length === 0) {
                    detailsHtml += '<em>No evaluation data yet</em>';
                }

                detailsHtml += '</div></td>';
                detailsRow.innerHTML = detailsHtml;
                tbody.appendChild(detailsRow);
            });
        }

        function toggleDetails(index) {
            const details = document.getElementById(`details-${index}`);
            details.classList.toggle('open');
        }

        renderCriteriaTable();
        renderConversations();
    </script>
</body>
</html>